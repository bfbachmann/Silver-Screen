<head>
    <title> SilverScreen </title>

    {# Load stylesheets #}
    {% load static %}
    <link rel="stylesheet" type="text/css" href="{% static "style.css" %}" />
    <script type="text/javascript" src="{% static "js/jquery.js" %}"></script>

    {# Load Chart.js #}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.3.0/Chart.bundle.min.js"></script>

    {# Load the tag library #}
    {% load bootstrap3 %}

    {# Load CSS and JavaScript #}
    {% bootstrap_css %}
    {% bootstrap_javascript %}
</head>

<body>
    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" href="/index">
                    SilverScreen
                </a>
                <form id="query-form" action="/results/" method="post" class="form navbar-form navbar-left">
                    {% csrf_token %}
                    {% bootstrap_form new_form %}
                    {% buttons %}
                        <button id="submit" type="submit" class="btn btn-primary">Search</button>
                        <div class="navbar-loader hidden"></div>
                    {% endbuttons %}
                </form>
            </div>
        </div>
    </nav>

    <div class="align-left" style="max-width: 80%; margin: auto;">
        <h1> {{ movie.Title }}</h1>
        <hr>
        <div class="well full-width clearfix">
            {% if movie.Poster %}
                <div class="col-sm-4 align-center">
                    <img src="{{ movie.Poster }}" class ="center-block img-responsive" />
                    <h3 class="info-header align-center">
                        <img class="rating-icon" src="{% static "imdb.png" %}" alt="IMDB"/> {{movie.imdbRating}}
                        <img class="rating-icon" src="{% static "rt.png" %}" alt="Rotten Tomatoes"/> {{movie.tomatoRating}}
                    </h3>
                </div>
                <div class="col-sm-8">
            {% endif %}
                <h3 class="info-header"> Sentiment Score:
                    {% if overall_score <= 0 %}
                        <strong style="color: red;">{{ overall_score }}</strong> </h3>
                    {% else %}
                        <strong style="color: green;">{{ overall_score }}</strong> </h3>
                    {% endif %}
                <h3 class="info-header">Polarity: {{polarity}}%</h3><br>
                <div class="col-sm-3" style="margin-left: 0px !important;">
                    <p>Genre: </p>
                    <p>BoxOffice: </p>
                    <p>Director: </p>
                    <p>Year: </p>
                    <p>Tomato Consensus: </p>
                </div>
                <div class="col-sm-9">
                    <p>{{movie.Genres}}</p>
                    <p>{{movie.BoxOffice}}</p>
                    <p>{{movie.Director}}</p>
                    <p>{{movie.Year}}</p>
                    <em>"{{movie.tomatoConsensus}}"</em>
                </div>
            {% if movie.Poster %}
                </div>
            {% endif %}
            <div class="align-center">
                <canvas id="bubble-chart"></canvas>
            </div>
        </div>
    </div>

    <div class="align-left" style="max-width: 800px; margin: auto;">
        {% for tweet in tweets %}
            <hr>
            <div class="container-fluid">
                <div class="col-sm-10">
                    <small> {{ tweet.created_at }} </small>
                    <p><strong style="color: 55acee;"> @{{ tweet.user_screen_name }} </strong> "{{tweet.text}}"</p>
                    <p>
                        <span class="glyphicon glyphicon-heart" style="color: red;"></span>
                        {{ tweet.favorite_count }} &nbsp; &nbsp;
                        <span class="glyphicon glyphicon-share" style="color: #55acee;"></span>
                        {{ tweet.retweet_count }} &nbsp; &nbsp;
                        {% if tweet.location and tweet.location != "" %}
                        <span class="glyphicon glyphicon-map-marker"></span>
                        {{ tweet.location }}
                        {% endif %}
                    </p>
                </div>
                <div class="col-sm-2">
                    {% if tweet.sentiment_score <= 0 %}
                        <h5 class="align-right" style="color: red;"> Score: {{ tweet.sentiment_score }} </h5>
                    {% else %}
                        <h5 class="align-right" style="color: green;"> Score: {{ tweet.sentiment_score }} </h5>
                    {% endif %}
                </div>
            </div>
        {% endfor %}
    </div>

    <script>
        $('#query-form').submit(function() {
            $('#submit').addClass('hidden')
            $('.navbar-loader').removeClass('hidden')
        })

        var ctx = document.getElementById("bubble-chart");
        var chart = new Chart(ctx,{
            type: 'bubble',
            data: { datasets: [ {
                           label: 'Negative Tweets',
                           data: [
                               {% for datum in negative_data %}
                                    { x: "{{ datum.x }}", y: {{ datum.y }}, r: {{ datum.r }} },
                               {% endfor %}
                           ],
                           backgroundColor:"#FF6384",
                           hoverBackgroundColor: "#FF6384",
                       }, {
                           label: 'Positive Tweets',
                           data: [
                               {% for datum in positive_data %}
                                    { x: "{{ datum.x }}", y: {{ datum.y }}, r: {{ datum.r }} },
                               {% endfor %}
                           ],
                           backgroundColor: "#00DD99",
                           hoverBackgroundColor: "#00DD99"
                       } ]
                   },
            options: {
                    scales: {
                        xAxes: [{
                            type: 'time',
                            time: {
                                unit: 'day'
                            }
                        }],
                        yAxes: [{
                            ticks: {
                                max: 100,
                                min: 0,
                            }
                        }]
                    }
                }
        });
    </script>
</body>
