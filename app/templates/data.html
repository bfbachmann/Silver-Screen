{% load static %}

<div class="align-left" style="max-width: 80%; margin: auto; margin-bottom: 30px;">
    <h1> {{ movie.Title }}</h1>
    <hr>
    <div class="well full-width clearfix">

        <!-- BEGIN MOVIE MOVE POSTER, INFO, AND PIE CHART -->
        <div class="container-fluid" style="width: 100%; padding: 0px;">

            <!-- BEGIN MOVIE POSTER -->
            <div class="col-sm-3 align-center">
                <img src="{{ movie.Poster }}" class ="center-block img-responsive" />
                <h3 class="info-header align-center">
                    <img class="rating-icon" src="{% static "imdb.png" %}" alt="IMDB"/> {{movie.imdbRating}}
                    <img class="rating-icon" src="{% static "rt.png" %}" alt="Rotten Tomatoes"/> {{movie.tomatoRating}}
                </h3>
            </div>
            <!-- END MOVIE POSTER -->

            <div class="no-padding col-sm-4">

                <!-- BEGIN MOVIE DATA SUMMARY -->
                <h3 class="info-header"> Sentiment Score:
                    {% if overall_score < 5 %}
                        <strong style="color: red;">{{ overall_score }}</strong>
                    {% else %}
                        <strong style="color: green;">{{ overall_score }}</strong>
                    {% endif %}
                </h3>
                <h3 class="info-header">Polarity: {{polarity}}%</h3>
                {% if movie.tomatoConsensus and movie.tomatoConsensus != "N/A" %}
                <p style="margin-bottom: 10px; color: grey;">Tomato Consensus: </p>
                <em>"{{movie.tomatoConsensus}}"</em>
                {% endif %}
                <!-- END MOVIE DATA SUMMARY -->

                <!-- BEGIN MOVIE INFO -->
                <div style="margin-top: 20px;">
                    {% if movie.Genres and movie.Genres != "N/A" %}
                    <div class="row">
                        <div class="col-md-3">
                            <p style="color: gray;">Genre: </p>
                        </div>
                        <div class="col-md-9">
                            <p>{{movie.Genres}}</p>
                        </div>
                    </div>
                    {% endif %}

                    {% if movie.BoxOffice and movie.BoxOffice != "N/A" %}
                    <div class="row">
                        <div class="col-md-3">
                            <p style="color: gray;">BoxOffice: </p>
                        </div>
                        <div class="col-md-9">
                            <p>{{movie.BoxOffice}}</p>
                        </div>
                    </div>
                    {% endif %}

                    {% if movie.Director and movie.Director != "N/A" %}
                    <div class="row">
                        <div class="col-md-3">
                            <p style="color: gray;">Director: </p>
                        </div>
                        <div class="col-md-9">
                            <p>{{movie.Director}}</p>
                        </div>
                    </div>
                    {% endif %}

                    <div class="row">
                        <div class="col-md-3">
                            <p style="color: gray;">Year: </p>
                        </div>
                        <div class="col-md-9">
                            <p>{{movie.Year}}</p>
                        </div>
                    </div>
                </div>
                <!-- END MOVIE INFO -->

            </div>

            <!-- BEGIN PIE CHART -->
            <div class="no-padding col-sm-5">
                <canvas id="pie-chart"></canvas>
            </div>
            <!-- END PIE CHART -->

        </div>
        <!-- END MOVIE POSTER, INFO, AND PIE CHART -->

    </div>

    <!-- BEGIN GRAPHS -->
    <div class="algin-left" style="width: 100%; margin-top: 10px;">
        <div class="align-left">
            <ul class="nav nav-tabs nav-justified">
                <li class="active"><a data-toggle="tab" href="#chart1">Avg. Sentiment Over Time</a></li>
                <li><a data-toggle="tab" href="#chart2">Individual Sentiment Over Time</a></li>
                <li><a data-toggle="tab" href="#tweets">Tweet Samples</a></li>
            </ul>
        </div>
        <div class="tab-content align-center">
            <div id="chart1" class="tab-pane fade in active">
                <canvas id="line-chart"></canvas>
            </div>
            <div id="chart2" class="tab-pane fade">
                <canvas id="bubble-chart"></canvas>
            </div>
            <div id="tweets" class="tab-pane fade">
                <!-- BEGIN TWEETS -->
                <div class="align-left" style="max-height: 600px; overflow-y: scroll; margin: auto;">
                    <hr>
                    {% for tweet in tweets %}
                        <div class="container-fluid">
                            <div class="col-sm-10">
                                <p>
                                    <strong style="color: 55acee;"> @{{ tweet.user_screen_name }} </strong>
                                    &nbsp; <small style="color: grey;"> {{ tweet.created_at }} </small>
                                </p>
                                <p>{{tweet.text}}</p>
                                <p>
                                    <span class="glyphicon glyphicon-heart" style="color: red;"></span>
                                    {{ tweet.favorite_count }} &nbsp; &nbsp;
                                    <span class="glyphicon glyphicon-share" style="color: #55acee;"></span>
                                    {{ tweet.retweet_count }} &nbsp; &nbsp;
                                    {% if tweet.location and tweet.location != "" %}
                                        <span class="glyphicon glyphicon-map-marker"></span>
                                    {{ tweet.location }}
                                    {% endif %}
                                </p>
                            </div>
                            <div class="col-sm-2">
                                {% if tweet.sentiment_score < 5 %}
                                    <h4 class="align-right" style="color: red;"> {{ tweet.sentiment_score }} </h4>
                                {% else %}
                                    <h4 class="align-right" style="color: green;"> {{ tweet.sentiment_score }} </h4>
                                {% endif %}
                            </div>
                        </div>
                        <hr>
                    {% endfor %}
                </div>
                <!-- END TWEETS -->
            </div>
        </div>
    </div>
    <!-- END GRAPHS -->
</div>

<script>
    $('#query-form').submit(function() {
        $('#submit').addClass('disabled')
        $('.navbar-loader').removeClass('hidden')
        $('#tabs').tabs()
    })

    // Begin Line Chart

    var lineChartCtx = $('#line-chart');
    var lineChart = new Chart(lineChartCtx,{
        type: 'line',
        data: {
            datasets: [ {
                       label: 'Negative Tweets',
                       fill: false,
                       data: [
                           {% for datum in negative_avgs %}
                                { x: "{{ datum.x }}", y: {{ datum.y }} },
                           {% endfor %}
                       ],
                       backgroundColor:"#FF6384",
                       borderColor: "#FF6384",
                       hoverBackgroundColor: "#FF6384",
                   }, {
                       label: 'Positive Tweets',
                       fill: false,
                       data: [
                           {% for datum in positive_avgs %}
                                { x: "{{ datum.x }}", y: {{ datum.y }} },
                           {% endfor %}
                       ],
                       backgroundColor: "#00DD99",
                       borderColor: "#00DD99",
                       hoverBackgroundColor: "#00DD99"
                   } ]
               },
        options: {
                title: {
                    display: true,
                    fontSize: 26,
                    text: 'Average Senitment Intensity Over Time'
                },
                scales: {
                    xAxes: [{
                        type: 'time',
                        time: {
                            unit: 'day'
                        }
                    }],
                    yAxes: [{
                        ticks: {
                            max: 100,
                            min: 0,
                        }
                    }]
                }
            }
    });

    // Begin Bubble Chart

    var bubbleChartCtx = $('#bubble-chart');
    var bubbleChart = new Chart(bubbleChartCtx,{
        type: 'bubble',
        data: {
            datasets: [ {
                       label: 'Negative Tweets',
                       data: [
                           {% for datum in negative_data %}
                                { x: "{{ datum.x }}", y: {{ datum.y }}, r: {{ datum.r }} },
                           {% endfor %}
                       ],
                       backgroundColor:"#FF6384",
                       hoverBackgroundColor: "#FF6384",
                   }, {
                       label: 'Positive Tweets',
                       data: [
                           {% for datum in positive_data %}
                                { x: "{{ datum.x }}", y: {{ datum.y }}, r: {{ datum.r }} },
                           {% endfor %}
                       ],
                       backgroundColor: "#00DD99",
                       hoverBackgroundColor: "#00DD99"
                   } ]
               },
        options: {
                title: {
                    display: true,
                    fontSize: 26,
                    text: 'Individual Senitment Intensity Over Time'
                },
                scales: {
                    xAxes: [{
                        type: 'time',
                        time: {
                            unit: 'day'
                        }
                    }],
                    yAxes: [{
                        ticks: {
                            max: 100,
                            min: 0,
                        }
                    }]
                }
            }
    });

    // Begin Pie Chart

    var pieChartCtx = $('#pie-chart');
    var pieChart = new Chart(pieChartCtx, {
        type: 'pie',
        data: {
            labels: [
                "Negative",
                "Neutral",
                "Positive",
            ],
            datasets: [{
                data: [
                    {{ negative_count }},
                    {{ neutral_count }},
                    {{ positive_count }},
                ],
                backgroundColor: [
                    "#FF6384",
                    "#0099FF",
                    "#00DD99",
                ],
                hoverBackgroundColor: [
                    "#FF6384",
                    "#0099FF",
                    "#00DD99",
                ],
                label: 'Senitment Scores'
            }]
        },
        options: {
            title: {
                display: true,
                fontSize: 20,
                text: 'Tweets by Senitment'
            }
        },
    });
</script>
